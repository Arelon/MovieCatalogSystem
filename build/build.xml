<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="MCS" basedir="." default="zip">

	<property name="src.version" value="0.42" />
	<property name="build.version" value="203" />

	<property name="root.dir" value=".." />
	<property name="src.dir" value="../src" />
	<property name="lib.dir" value="../lib" />
	<property name="db.dir" value="distDB" />
	<property name="restore.dir" value="restore" />
	<property name="export.dir" value="../startup/export" />
	<property name="restore.dir" value="../startup/restore" />
	<property name="startup.dir" value="../startup" />
	
	<property name="compile.dir" value="compile" />
	<property name="distro.dir" value="distro" />

	<path id="classpath">
		<fileset dir="${lib.dir}">
			<include name="*.*" />
		</fileset>
	</path>

	<target name="init" description="Init tasks">
		<delete dir="${compile.dir}" failonerror="false" />
		<delete dir="${distro.dir}" failonerror="false" />
		<tstamp />
	</target>

	<target name="compile" description="Copying compiled MCS files" depends="init">
		<mkdir dir="${compile.dir}" />
		
		<javac srcdir="${src.dir}"  classpathref="classpath"  target="1.6" destdir="${compile.dir}" encoding="UTF-8">
		</javac>
		
		<copy todir="${compile.dir}" overwrite="true">
			<fileset dir="${src.dir}">
				<exclude name="**/*.java" />
			</fileset>
		</copy>
	</target>

	<target name="jar" description="JARs the MovieCatalogSystem" depends="compile">
		<mkdir dir="${distro.dir}" />
			
		<jar destfile="${distro.dir}/mcs.jar">
			<manifest>
				<attribute name="Manifest-Version" value="1.0" />
				<attribute name="Main-Class" value="net.milanaleksic.mcs.Startup" />
				<attribute name="Implementation-Version" value="${src.version}.${build.version}" />
			</manifest>
			<fileset dir="${compile.dir}" />
		</jar>
		
		<copy todir="${lib.dir}" file="${distro.dir}/mcs.jar" overwrite="true" />
	</target>

	<target name="zip" description="ZIPs the whole distro" depends="jar">
		<mkdir dir="${distro.dir}" />

		<delete>
			<fileset dir=".">
				<include name="${ant.project.name}-${src.version}.${build.version}-${DSTAMP}*.zip" />
			</fileset>
		</delete>

		<copy todir="${distro.dir}" overwrite="true">
			<fileset dir="${startup.dir}" excludes="*reveng*,*dev*">
				<include name="*.properties" />
				<include name=".launcher" />
				<include name=".lock" />
				<include name="*.xml" />
				<include name="*.jpg" />
			</fileset>
		</copy>
		
		<delete file="${ant.project.name}-${src.version}.${build.version}-*.zip" failonerror="false" />

		<zip destfile="${ant.project.name}-${src.version}.${build.version}-${DSTAMP}${TSTAMP}.zip">
			<zipfileset dir="${lib.dir}" prefix="lib" excludes="*db2*.jar,mcs.jar" />
			<zipfileset dir="${distro.dir}" prefix="bin" excludes="*.jar" />
			<zipfileset dir="${distro.dir}" prefix="lib" includes="*.jar" />
			<zipfileset dir="${root.dir}" prefix="" includes="*.exe" />
			<zipfileset dir="${db.dir}" prefix="bin/db" />
			<zipfileset dir="${export.dir}" prefix="bin/export" />
			<zipfileset dir="${restore.dir}" prefix="bin/restore" />
		</zip>

		<delete dir="${compile.dir}" failonerror="false" />
		<delete dir="${distro.dir}" failonerror="false" />
	</target>


</project>