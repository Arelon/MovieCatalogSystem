create schema if not exists DB2ADMIN;

drop table DB2ADMIN.param if exists;

drop table DB2ADMIN.logerakcija if exists;

drop table DB2ADMIN.loger if exists;

drop table DB2ADMIN.zauzima if exists;

drop table DB2ADMIN.film if exists;

drop table DB2ADMIN.medij if exists;

drop table DB2ADMIN.tipmedija if exists;

drop table DB2ADMIN.zanr if exists;

drop table DB2ADMIN.pozicija if exists;

CREATE TABLE DB2ADMIN.Param (
    IdParam INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    Name varchar(100) NOT NULL,
    Value varchar(100) NOT NULL
);

CREATE TABLE DB2ADMIN.Loger(
    IdLoger INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    IdLogerAkcija int NOT NULL,
    Kontekst varchar(100) NOT NULL,
    Vreme TIMESTAMP NOT NULL
);

CREATE TABLE DB2ADMIN.LogerAkcija (
    IdLogerAkcija INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    Naziv varchar(100) NOT NULL
);

CREATE TABLE DB2ADMIN.Film(
    IdFilm INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    NazivFilma varchar(100) NOT NULL,
    PrevodNazivaFilma varchar(100) NOT NULL,
    Godina int NOT NULL,
    IdZanr int NOT NULL,
    Komentar varchar(1000),
    IMDBRejting numeric(3, 1) NOT NULL
);

CREATE TABLE DB2ADMIN.Medij(
    IdMedij INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    Indeks int NOT NULL,
    idTip int NOT NULL,
    IdPozicija int NOT NULL
);

CREATE TABLE DB2ADMIN.Pozicija(
    IdPozicija INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    Pozicija varchar(100) NOT NULL
);

CREATE TABLE DB2ADMIN.TipMedija(
    IdTip INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    Naziv varchar(100) NOT NULL
);

CREATE TABLE DB2ADMIN.Zanr(
    IdZanr INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    Zanr varchar(100) NOT NULL
);

CREATE TABLE DB2ADMIN.Zauzima(
    idMedij int NOT NULL,
    idFilm int NOT NULL
);

ALTER TABLE DB2ADMIN.Film  ADD  FOREIGN KEY(IdZanr)
REFERENCES DB2ADMIN.Zanr (IdZanr);

ALTER TABLE DB2ADMIN.Medij  ADD  FOREIGN KEY(IdPozicija)
REFERENCES DB2ADMIN.Pozicija (IdPozicija);

ALTER TABLE DB2ADMIN.Medij  ADD  FOREIGN KEY(idTip)
REFERENCES DB2ADMIN.TipMedija (IdTip);

ALTER TABLE DB2ADMIN.Zauzima  ADD  FOREIGN KEY(idFilm)
REFERENCES DB2ADMIN.Film (IdFilm)
ON DELETE CASCADE;

ALTER TABLE DB2ADMIN.Zauzima  ADD  FOREIGN KEY(idMedij)
REFERENCES DB2ADMIN.Medij (IdMedij)
ON DELETE CASCADE;

ALTER TABLE DB2ADMIN.Loger  ADD  FOREIGN KEY(idLogerAkcija)
REFERENCES DB2ADMIN.LogerAkcija (IdLogerAkcija)
ON DELETE CASCADE;

DROP INDEX DB2ADMIN.IDX_PARAM_NAME IF EXISTS;
CREATE UNIQUE INDEX DB2ADMIN.IDX_PARAM_NAME on DB2ADMIN.PARAM("NAME");

DROP INDEX DB2ADMIN.IDX_FILM_NAZIVFILMA IF EXISTS;
CREATE INDEX DB2ADMIN.IDX_FILM_NAZIVFILMA on DB2ADMIN.FILM("NAZIVFILMA");

DROP INDEX DB2ADMIN.IDX_FILM_PREVODNAZIVAFILMA IF EXISTS;
CREATE INDEX DB2ADMIN. IDX_FILM_PREVODNAZIVAFILMA on DB2ADMIN.FILM("PREVODNAZIVAFILMA");

DROP INDEX DB2ADMIN.IDX_FILM_IDZANR IF EXISTS;
CREATE INDEX DB2ADMIN.IDX_FILM_IDZANR on DB2ADMIN.FILM("IDZANR");

DROP INDEX DB2ADMIN.IDX_MEDIJ_INDEKS IF EXISTS;
CREATE INDEX DB2ADMIN.IDX_MEDIJ_INDEKS on DB2ADMIN.MEDIJ("INDEKS");

DROP INDEX DB2ADMIN.IDX_MEDIJ_IDPOZICIJA IF EXISTS;
CREATE INDEX DB2ADMIN.IDX_MEDIJ_IDPOZICIJA on DB2ADMIN.MEDIJ("IDPOZICIJA");

DROP INDEX DB2ADMIN.IDX_ZAUZIMA_IDMEDIJ IF EXISTS;
CREATE INDEX DB2ADMIN.IDX_ZAUZIMA_IDMEDIJ on DB2ADMIN.ZAUZIMA("IDMEDIJ");

DROP INDEX DB2ADMIN.IDX_ZAUZIMA_IDFILM IF EXISTS;
CREATE INDEX DB2ADMIN.IDX_ZAUZIMA_IDFILM on DB2ADMIN.ZAUZIMA("IDFILM");

INSERT INTO DB2ADMIN.PARAM(Name, Value)
VALUES('VERSION', '1');
